
<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GratiToad Sentiment Analyzer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Side Menu -->
    <div class="side-menu" id="side-menu">
        <button class="close-menu" id="close-menu">‚úñ</button>
        <ul>
            <li><a href="#about">About</a></li>
            <li><a href="#howToUse">How to use</a></li>
            <li><a href="#favorites">Past Gratitudes</a></li>
            <li><a href="#contact">Contact us</a></li>
        </ul>
    </div>

    <!-- Overlay -->
    <div class="menu-overlay" id="menu-overlay"></div>

    <div class="container">
        <div class="header">
            <h1>GratiToad</h1>
            <p class="subtitle">What's on your mind?</p>
        </div>

        <form id="sentimentForm" class="input-container">
            <textarea 
                id="textInput" 
                name="text" 
                required>
            </textarea>
            <div class="sentiment-selector">
                    <label for="userSentiment"></label>
                    <select id="userSentiment" name="userSentiment">
                        <option value="" disabled selected>How does thet make you feel?</option>
                        <option value="3">+3 (Very positive)</option>
                        <option value="2">+2 (Positive)</option>
                        <option value="1">+1 (Somewhat positive)</option>
                        <option value="0">0 (Neutral)</option>
                        <option value="-3">-3 (Very negative)</option>
                        <option value="-1">-1 (Somewhat negative)</option>
                        <option value="-2">-2 (Negative)</option>
                    </select>
                </div>
            <button type="submit" class="submit-btn">Share</button>
        </form>

        <div id="result" class="result-container">
            <div id="sentimentResult" class="result-text"></div>
        </div>

        <div class="toad-container">
            <div class="toad-placeholder">üê∏</div>
        </div>
    </div>

    <script>
        // Menu functionality
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sideMenu = document.getElementById('side-menu');
        const closeMenu = document.getElementById('close-menu');
        const menuOverlay = document.getElementById('menu-overlay');

        function openMenu() {
            sideMenu.classList.add('open');
            menuOverlay.classList.add('active');
            hamburgerMenu.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling when menu is open
        }

        function closeMenuFunc() {
            sideMenu.classList.remove('open');
            menuOverlay.classList.remove('active');
            hamburgerMenu.classList.remove('active');
            document.body.style.overflow = 'auto'; // Re-enable scrolling
        }

        hamburgerMenu.addEventListener('click', openMenu);
        closeMenu.addEventListener('click', closeMenuFunc);
        menuOverlay.addEventListener('click', closeMenuFunc);

        // Close menu when pressing Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && sideMenu.classList.contains('open')) {
                closeMenuFunc();
            }
        });

         // Sentiment analysis form
        document.getElementById('sentimentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const phrase = document.getElementById('textInput').value;
            const userSentiment = document.getElementById('userSentiment').value;
            
            // H√§r kan du skicka b√•de text och userSentiment till din Spring Boot backend
            // Konfigurera din backend URL
const API_BASE_URL = 'http://localhost:8080';

// Funktion f√∂r att skicka ny fras till backend
async function savePhrase(phraseData) {
    try {
        const response = await fetch(`${API_BASE_URL}/phrases`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(phraseData)
        });

        if (response.ok) {
            const message = await response.text();
            console.log('Success:', message);
            return { success: true, message: message };
        } else {
            const errorMessage = await response.text();
            console.error('Error:', errorMessage);
            return { success: false, message: errorMessage };
        }
    } catch (error) {
        console.error('Network error:', error);
        return { success: false, message: 'N√§tverksfel: Kunde inte ansluta till servern' };
    }
}

// Funktion f√∂r att h√§mta alla fraser fr√•n backend
async function getAllPhrases() {
    try {
        const response = await fetch(`${API_BASE_URL}/phrases`);
        
        if (response.ok) {
            const phrases = await response.json();
            return { success: true, data: phrases };
        } else {
            const errorMessage = await response.text();
            return { success: false, message: errorMessage };
        }
    } catch (error) {
        console.error('Network error:', error);
        return { success: false, message: 'Kunde inte h√§mta fraser' };
    }
}

// Huvudfunktion som k√∂rs n√§r sidan laddas
document.addEventListener('DOMContentLoaded', function() {
    
    // Hitta formul√§ret (anpassa selector efter ditt HTML)
    const form = document.getElementById('phraseForm');
    const textInput = document.getElementById('phraseText');
    const submitButton = document.getElementById('submitBtn');
    const messageDiv = document.getElementById('message');
    const phrasesContainer = document.getElementById('phrasesContainer');

    // Hantera formul√§rinl√§mning
    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault(); // F√∂rhindra standard form submission
            
            // H√§mta v√§rden fr√•n formul√§ret
            const phraseText = textInput.value.trim();
            
            // Validera input
            if (!phraseText) {
                showMessage('V√§nligen skriv in en fras', 'error');
                return;
            }

            // Visa loading state
            submitButton.disabled = true;
            submitButton.textContent = 'Sparar...';

            // Skapa phrase object (anpassa efter din Phrase entity struktur)
            const phraseData = {
                text: phraseText,
                // L√§gg till andra f√§lt som din Phrase entity har
                // t.ex. category, sentiment, etc.
            };

            // Skicka till backend
            const result = await savePhrase(phraseData);

            if (result.success) {
                showMessage('Frasen sparades framg√•ngsrikt!', 'success');
                textInput.value = ''; // Rensa formul√§ret
                loadAndDisplayPhrases(); // Uppdatera listan
            } else {
                showMessage(`Fel: ${result.message}`, 'error');
            }

            // √Öterst√§ll knappen
            submitButton.disabled = false;
            submitButton.textContent = 'Spara Fras';
        });
    }

    // Funktion f√∂r att visa meddelanden
    function showMessage(message, type) {
        if (messageDiv) {
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // D√∂lj meddelandet efter 5 sekunder
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    }

    // Funktion f√∂r att ladda och visa alla fraser
    async function loadAndDisplayPhrases() {
        if (!phrasesContainer) return;

        const result = await getAllPhrases();
        
        if (result.success) {
            displayPhrases(result.data);
        } else {
            phrasesContainer.innerHTML = `<p class="error">Kunde inte ladda fraser: ${result.message}</p>`;
        }
    }

    // Funktion f√∂r att visa fraser i HTML
    function displayPhrases(phrases) {
        if (!Array.isArray(phrases) || phrases.length === 0) {
            phrasesContainer.innerHTML = '<p>Inga fraser att visa.</p>';
            return;
        }

        const html = phrases.map(phrase => `
            <div class="phrase-item" data-id="${phrase.id}">
                <p class="phrase-text">${escapeHtml(phrase.text)}</p>
                <div class="phrase-actions">
                    <button onclick="deletePhrase(${phrase.id})" class="delete-btn">Ta bort</button>
                </div>
            </div>
        `).join('');

        phrasesContainer.innerHTML = html;
    }

    // Hj√§lpfunktion f√∂r att escapea HTML
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Ladda fraser n√§r sidan laddas
    loadAndDisplayPhrases();
});

// Funktion f√∂r att ta bort en fras (global s√• den kan anropas fr√•n HTML)
async function deletePhrase(id) {
    if (!confirm('√Ñr du s√§ker p√• att du vill ta bort denna fras?')) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/phrases/${id}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            // Ta bort elementet fr√•n DOM
            const phraseElement = document.querySelector(`[data-id="${id}"]`);
            if (phraseElement) {
                phraseElement.remove();
            }
            
            // Visa bekr√§ftelsemeddelande
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.textContent = 'Frasen togs bort framg√•ngsrikt!';
                messageDiv.className = 'message success';
                messageDiv.style.display = 'block';
                setTimeout(() => messageDiv.style.display = 'none', 3000);
            }
        } else {
            const errorMessage = await response.text();
            alert(`Fel vid borttagning: ${errorMessage}`);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('N√§tverksfel vid borttagning av fras');
    }
}
            
            // Simulerad respons f√∂r demo   To do
            setTimeout(() => {
                const isPositive = Math.random() > 0.5;
                const result = document.getElementById('result');
                const resultText = document.getElementById('sentimentResult');
                
                let resultMessage = '';
                if (userSentiment) {
                    const rating = parseInt(userSentiment);
                    if (rating >= 2) {
                        resultMessage = `‚ú® (${userSentiment})! GratiToad jumps with joy! üê∏üíö`;
                    } else if (rating === 1) {
                        resultMessage = `üòä (${userSentiment}). GratiToad looks happy! üê∏`;
                    } else if (rating === 0) {
                        resultMessage = `üòê (${userSentiment}). GratiToad is intrigued üê∏`;
                    } else if (rating === -1) {
                        resultMessage = `üòî (${userSentiment}). A new anxiety mosquito starts buzzing `;
                    } else if (rating <= -2) {
                        resultMessage = `üò¢ (${userSentiment}). A fat anxiety mosquito is flying around `;
                    }
                    
                    resultText.className = `result-text ${rating >= 0 ? 'positive' : 'negative'}`;
                } else {
                    // Fallback om ingen rating valts
                    if (isPositive) {
                        resultMessage = '‚ú® randomised AI: GratiToad jumps with joy, keep at it! üê∏üíö';
                        resultText.className = 'result-text positive';
                    } else {
                        resultMessage = 'üåßÔ∏è randomised AI: A fat anxiety mosquito starts flying around ' ;
                        resultText.className = 'result-text negative';
                    }
                }
                
                resultText.innerHTML = resultMessage;
                result.classList.add('show');
            }, 1000);
        });
    </script>
</body>
</html>